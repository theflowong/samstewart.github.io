<!DOCTYPE html>
<html>
<head>
<title>Three.js test diagram</title>
<style>
	body { margin: 0; }
	canvas { width: 100%; height: 100% }
</style>

<!-- GSL shaders -->
<script type="x-shader/x-vertex" id="vertexshader">
	varying vec2 vUv;

	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}

</script>
<script type="x-shader/x-fragment" id="debugshader">
	varying vec2 vUv;
	uniform sampler2D texture;

	void main() {
		gl_FragColor = texture2D(texture, vUv);
	}

</script>

<script type="x-shader/x-fragment" id="fragmentshader">
	varying vec2 position;
	uniform sampler2D texture;

	void main() {
		vec2 p = position;
		if (p.x > .5) {
			p.x = 1.0 - p.x;
		} 

		gl_FragColor = texture2D(texture, p);	
		
	}

</script>

<!-- Shaders for fluid simulation -->
<script type="x-shader/x-fragment" id="pressureShader">
	varying vec2 vUv;

	// the pressure field itself
	uniform sampler2D texture;
	// the divergence field (right hand side of Poisson equation)
	uniform sampler2D divergence;

	// the grid size
	uniform dx;

	void main() {
		// do one step of Jacobi iteration (assuming we CLAMP_TO_BOUNDARY) the texture coordinates.
		float left = texture2D(texture, vUv - vec2(dx, 0));
		float right = texture2D(texture, vUv + vec2(dx, 0));
		float top = texture2D(texture, vUv + vec2(0, dx));
		float bottom = texture2D(texture, vUv - vec2(0, dx));

		// since we are solving for a scalar field, we store everything in the first coordinate.
		float center = texture2D(divergence, vUv).x;

		// stencil for solving pressure Poisson equation is given by
		// [1/4 1/4 1/4 1/4 -b_grid.dx()^2 / 4]

		gl_FragColor = vec4(.25 * (left + right + top + bottom + -(dx*dx) * center), 1.0);
		
	}
</script>
<!-- Copyright (c) 2010-2015 The MathJax Consortium -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="text/javascript" src="scripts/three.js"></script>
<script type="text/javascript" src="scripts/OrbitControls.js"></script>
<script type="text/javascript" src="scripts/jquery-3.1.0.min.js"></script>

<script type="text/javascript" src="js/TextureUtils.js"></script>
<script type="text/javascript" src="js/fluid/fluid.js"></script>
<script type="text/javascript" src="js/fluid/RenderTarget.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script type="text/javascript" src="js/app.js"></script>
</head>
<body>

</body>
</html>
